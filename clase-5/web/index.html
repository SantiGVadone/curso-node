<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movies API Manager</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">

  <style>
    /* --- VARIABLES --- */
    :root {
      --bg-color: #0f0f10;
      --card-bg: #1a1a1d;
      --text-main: #ffffff;
      --text-sec: #a0a0a0;
      --accent: #8a2be2; /* Violeta Ne√≥n */
      --danger: #e63946; /* Rojo */
      --radius: 12px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: var(--bg-color);
      color: var(--text-main);
      font-family: 'Manrope', sans-serif;
      padding: 2rem;
    }

    /* --- HEADER --- */
    header { text-align: center; margin-bottom: 3rem; }
    h1 {
      font-weight: 800; font-size: 2.5rem;
      background: linear-gradient(to right, #fff, #aaa);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }
    .subtitle { color: var(--text-sec); font-size: 0.9rem; }

    /* --- GRID --- */
    main {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* --- TARJETA --- */
    article {
      background-color: var(--card-bg);
      border-radius: var(--radius);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
      border: 1px solid #333;
    }

    article:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
      border-color: var(--accent);
    }

    .poster-wrapper { width: 100%; aspect-ratio: 2/3; overflow: hidden; }
    img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
    article:hover img { transform: scale(1.05); }

    .info { padding: 1.2rem; display: flex; flex-direction: column; flex-grow: 1; }
    h2 { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem; line-height: 1.3; }
    
    .year {
      font-size: 0.8rem; color: var(--text-sec);
      background: rgba(255,255,255,0.1); padding: 2px 8px;
      border-radius: 4px; width: fit-content; margin-bottom: 1rem;
    }

    /* --- BOTONES DE ACCI√ìN --- */
    .actions {
      margin-top: auto; /* Empuja los botones al fondo */
      display: flex;
      gap: 10px;
    }

    button {
      flex: 1; /* Que ocupen el mismo ancho */
      padding: 0.6rem;
      border-radius: 8px;
      font-family: inherit; font-weight: 600; font-size: 0.85rem;
      cursor: pointer; transition: all 0.2s;
      background: transparent;
    }

    /* Estilo Bot√≥n Eliminar */
    .delete-btn { border: 1px solid var(--danger); color: var(--danger); }
    .delete-btn:hover { background-color: var(--danger); color: white; }

    /* Estilo Bot√≥n Editar (NUEVO) */
    .update-btn { border: 1px solid var(--accent); color: var(--accent); }
    .update-btn:hover { background-color: var(--accent); color: white; }

    .loading { text-align: center; grid-column: 1 / -1; color: var(--text-sec); }

  </style>

  <script type="module">
    // RECUERDA CAMBIAR TU IP SI ES NECESARIO
    const API_URL = 'http://localhost:1234/movies'; //aca tengo que poner la url de la api

    const main = document.querySelector('main');

    const createMovieCard = (movie) => {
      return `
        <article data-id="${movie.id}">
          <div class="poster-wrapper">
            <img src="${movie.poster}" alt="${movie.title}" loading="lazy">
          </div>
          <div class="info">
            <h2>${movie.title}</h2>
            <span class="year">${movie.year}</span>
            
            <div class="actions">
              <button class="update-btn">‚úèÔ∏è Editar</button>
              <button class="delete-btn">üóëÔ∏è Eliminar</button>
            </div>
            
          </div>
        </article>
      `;
    }

    // Cargar pel√≠culas
    fetch(API_URL)
      .then(res => res.json())
      .then(movies => {
        const html = movies.map(createMovieCard).join('')
        main.innerHTML = html
      })
      .catch(err => console.error(err))

    // MANEJO DE CLICKS (Delegaci√≥n de eventos)
    document.addEventListener('click', e => {
      const target = e.target;
      const article = target.closest('article');
      if (!article) return; // Si clickeo fuera de una tarjeta, no hago nada
      
      const id = article.dataset.id;

      // --- LOGICA DE ELIMINAR ---
      if (target.matches('.delete-btn')) {
        target.textContent = '...';
        fetch(`${API_URL}/${id}`, { method: 'DELETE' })
          .then(res => {
            if (res.ok) {
              article.style.transform = 'scale(0)';
              setTimeout(() => article.remove(), 300);
            }
          })
      }

      // --- LOGICA DE ACTUALIZAR (PATCH) ---
      if (target.matches('.update-btn')) {
        // Pedimos el nuevo dato (Por simplicidad, editamos el A√ëO)
        const currentYear = article.querySelector('.year').textContent;
        const newYear = prompt('Ingresa el nuevo a√±o de lanzamiento:', currentYear);

        // Si el usuario cancela o lo deja vac√≠o, no hacemos nada
        if (newYear === null || newYear === currentYear) return;

        // Feedback visual
        const originalText = target.textContent;
        target.textContent = 'Guardando...';

        fetch(`${API_URL}/${id}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            year: parseInt(newYear) // Convertimos a n√∫mero porque la API espera int
          })
        })
        .then(res => {
          if (res.ok) {
            return res.json();
          } else {
            throw new Error('Error al actualizar');
          }
        })
        .then(updatedMovie => {
          // Actualizamos el DOM con el dato que devolvi√≥ el servidor
          article.querySelector('.year').textContent = updatedMovie.year;
          target.textContent = '¬°Listo!';
          setTimeout(() => target.textContent = originalText, 1500);
        })
        .catch(err => {
          alert('Hubo un error al actualizar');
          console.error(err);
          target.textContent = originalText;
        });
      }
    });
  </script>
</head>
<body>
  
  <header>
    <h1>üé¨ Movies Manager</h1>
    <p class="subtitle">CRUD completo con Node.js & Express</p>
  </header>

  <main>
    <h2 class="loading">Cargando pel√≠culas...</h2>
  </main>

</body>
</html>